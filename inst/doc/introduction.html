<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Introduction</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<h2>Introduction</h2>

<p>Calculate comorbidities, and perform fast and accurate
validation, conversion, manipulation, filtering and comparison of ICD-9-CM
(clinical modification) codes. ICD-9 codes appear numeric but leading and
trailing zeroes, and both decimal and non-decimal &ldquo;short&rdquo; format codes
exist. The package enables a work flow from raw lists of ICD-9 codes from
hospital billing databases to comorbidities. ICD-9 to comorbidity mappings
from Quan (Deyo and Elixhauser versions), Elixhauser and AHRQ included.</p>

<p>When calcuating which patients have which comorbidities, the input data is typically structured as follows:</p>

<pre><code>#&gt;   visitId  icd9  poa
#&gt; 1    1000 40201    Y
#&gt; 2    1000  2258 &lt;NA&gt;
#&gt; 3    1000  7208    N
#&gt; 4    1000 25001    Y
#&gt; 5    1001 34400    X
#&gt; 6    1001  4011    Y
#&gt; 7    1002  4011    E
</code></pre>

<p>or</p>

<pre><code>#&gt;   visitId icd_01 icd_02 icd_03 icd_04
#&gt; 1    1000  40201   2258   7208  25001
#&gt; 2    1001  34400   4011              
#&gt; 3    1002   4011
</code></pre>

<p>Of course, in real life, there are many problems with the data, such is <code>NA</code> entries, out-of-order <code>visitId</code>s, non-existent or invalid ICD-9 codes, etc.. Tools are provided to clean up the mess, and discover the comorbidities before admission or after discharge for these patients (or simply for any list of patients and ICD-9 codes: there is no requirement to work in the hospital admission paradigm.) The optional <code>poa</code> field indicates whether the code was determined to be <em>present on arrival</em>. The implicit default is to ignore it, and give ICD-9 code regardless of POA status, but filtering functions are provided and demonstrated later in this vignette.</p>

<p>The comorbidities can be determined as follows (showing the first few columns for brevity):</p>

<pre><code class="r">icd9ComorbidAhrq(patientData)[, 1:8]
#&gt;   visitId   CHF Valvular  PHTN   PVD  HTN Paralysis NeuroOther
#&gt; 1    1000  TRUE    FALSE FALSE FALSE TRUE     FALSE      FALSE
#&gt; 2    1001 FALSE    FALSE FALSE FALSE TRUE      TRUE      FALSE
#&gt; 3    1002 FALSE    FALSE FALSE FALSE TRUE     FALSE      FALSE
</code></pre>

<p>or</p>

<pre><code class="r">icd9ComorbidQuanDeyo(patientData)[, 1:8]
#&gt;   visitId    MI   CHF   PVD Stroke Dementia Pulmonary Rheumatic
#&gt; 1    1000 FALSE  TRUE FALSE  FALSE    FALSE     FALSE     FALSE
#&gt; 2    1001 FALSE FALSE FALSE  FALSE    FALSE     FALSE     FALSE
#&gt; 3    1002 FALSE FALSE FALSE  FALSE    FALSE     FALSE     FALSE
</code></pre>

<p>and things work beautifully using <a href="http://cran.r-project.org/web/packages/magrittr/index.html">magrittr</a> <code>%&gt;%</code> to chain functions together. This is not a dependency for this package, but is recommended because of the frequent need to chain together icd9 commands, and greater clarity.</p>

<pre><code class="r">patientData %&gt;%
  icd9FilterPoaYes() %&gt;%
  icd9ComorbidAhrq() %&gt;%
  extract(1:8)
#&gt;   visitId   CHF Valvular  PHTN   PVD  HTN Paralysis NeuroOther
#&gt; 1    1000  TRUE    FALSE FALSE FALSE TRUE     FALSE      FALSE
#&gt; 2    1001 FALSE    FALSE FALSE FALSE TRUE     FALSE      FALSE
</code></pre>

<h2>Converting ICD-9 codes between types</h2>

<p>ICD-9 codes are usually presented in <em>decimal</em> format (beware, for this is not a number), e.g. <code>003.21</code>, whereas most electronic records seem to use the <em>short</em> form without a decimal place. These are not interchangeable simply by removing the decimal place, and great care is taken to do this correctly. The functions were also designed to deal with the common problem of incorrectly formatted ICD-9 codes. The assumption is made that short codes of three or fewer characters are  describing only the &#39;major&#39; part: there is no other reasonable interpretation. For example, <code>020</code> must be taken to mean <code>20</code>, not <code>2.0</code> or even <code>0.20</code>. In most cases, when <em>icd9</em> works on ICD-9 codes, it will convert any codes of fewer than three characters into zero-padded three-digit codes.</p>

<pre><code class="r">icd9DecimalToShort(c(&quot;1&quot;, &quot;10.20&quot;, &quot;100&quot;, &quot;123.45&quot;))
#&gt; [1] &quot;001&quot;   &quot;01020&quot; &quot;100&quot;   &quot;12345&quot;
icd9ShortToDecimal(c(&quot;1&quot;, &quot;22&quot;, &quot;2244&quot;, &quot;1005&quot;))
#&gt; [1] &quot;001&quot;   &quot;022&quot;   &quot;224.4&quot; &quot;100.5&quot;

# similar operations with magrittr, also showing invalid codes
codes &lt;- c(&quot;87.65&quot;, &quot;9999&quot;, &quot;Aesop&quot;, -100, &quot;&quot;, NA)
icd9DecimalToShort(codes)
#&gt; [1] &quot;08765&quot; NA      NA      NA      NA      NA
</code></pre>

<h2>Validation of ICD-9 codes</h2>

<pre><code class="r">icd9IsValidDecimal(&quot;V10.2&quot;)
#&gt; [1] TRUE
icd9IsValidShort(c(&quot;099.17&quot;, &quot;-1&quot;))
#&gt; [1] FALSE FALSE
icd9IsValidDecimal(c(&quot;099.17&quot;, &quot;-1.1&quot;))
#&gt; [1]  TRUE FALSE
icd9IsValidShort(c(&quot;1&quot;, &quot;001&quot;, &quot;100&quot;, &quot;123456&quot;, &quot;003.21&quot;))
#&gt; [1]  TRUE  TRUE  TRUE FALSE FALSE
</code></pre>

<p>Validation forces the package user to provide character format ICD-9 codes. If great care is taken, passing some integers could be valid, but given the high chance of mistakes, and the simplicity of dealing entirely with character input, character is enforced:</p>

<pre><code class="r">icd9IsValidShort(100) # gives a warning
</code></pre>

<h2>Ranges of ICD-9 codes</h2>

<p>These functions generate syntactically valid ICD-9 codes, without including parent codes when the range limit would subset the parent. E.g. <code>&quot;100.99&quot; %i9d% &quot;101.01&quot;</code> does not include <code>100</code> or <code>100.0</code>, both of which imply larger subsets than requested by the range command (i.e. every code up to <code>100.99</code>). The shorter forms <code>%i9s%</code> and <code>%i9d%</code> return only <em>real</em> codes (i.e. listed in the CMS definitions as either three-digit codes or diagnoses), whereas <code>%i9sa%</code> and <code>%i9da%</code> return all possible syntactically valid ICD-9 codes:</p>

<pre><code class="r"># get all possible codes
&quot;003&quot; %i9sa% &quot;0033&quot; %&gt;% head(9) # show first 9 of 111 values
#&gt; [1] &quot;003&quot;   &quot;0030&quot;  &quot;00300&quot; &quot;00301&quot; &quot;00302&quot; &quot;00303&quot; &quot;00304&quot; &quot;00305&quot; &quot;00306&quot;
# just get the ones which correspond to diagnoses (keeping the 3-digit chapters)
&quot;003&quot; %i9s% &quot;0033&quot;
#&gt; [1] &quot;003&quot;   &quot;0030&quot;  &quot;0031&quot;  &quot;00320&quot; &quot;00321&quot; &quot;00322&quot; &quot;00323&quot; &quot;00324&quot; &quot;00329&quot;

&quot;10099&quot; %i9sa% &quot;10101&quot;
#&gt; [1] &quot;10099&quot; &quot;101&quot;   &quot;1010&quot;  &quot;10100&quot; &quot;10101&quot;
&quot;V10&quot; %i9da% &quot;V10.02&quot;
#&gt; [1] &quot;V10&quot;    &quot;V10.0&quot;  &quot;V10.00&quot; &quot;V10.01&quot; &quot;V10.02&quot;
&quot;E987&quot; %i9da% &quot;E988.1&quot;
#&gt;  [1] &quot;E987&quot;   &quot;E987.0&quot; &quot;E987.1&quot; &quot;E987.2&quot; &quot;E987.3&quot; &quot;E987.4&quot; &quot;E987.5&quot;
#&gt;  [8] &quot;E987.6&quot; &quot;E987.7&quot; &quot;E987.8&quot; &quot;E987.9&quot; &quot;E988&quot;   &quot;E988.0&quot; &quot;E988.1&quot;

# can&#39;t range between different types:
# &quot;V10&quot; %i9s% &quot;E800&quot; # throws an error
</code></pre>

<p>Another way of specifying ranges are to use function calls. These are exactly equivalent to the <code>%i9s%</code> and <code>%i9d%</code> range operators. This example shows the result when the user specifies a range which would include parents but not all their children:</p>

<pre><code class="r">icd9ExpandRangeShort(&quot;V100&quot;, &quot;V1002&quot;, onlyReal = TRUE) # default
#&gt; [1] &quot;V1000&quot; &quot;V1001&quot; &quot;V1002&quot;
icd9ExpandRangeShort(&quot;V100&quot;, &quot;V1002&quot;, onlyReal = FALSE) # V10.0 is not a leaf node
#&gt; [1] &quot;V100&quot;  &quot;V1000&quot; &quot;V1001&quot; &quot;V1002&quot;
</code></pre>

<p>Although <code>V10.0</code> would include ten children, the range only returns 4 values. In all other cases, parents are omitted to avoid the range returning broader classifications than intended.</p>

<p>It is easy to find the children of a higher-level ICD-9 code:</p>

<pre><code class="r">icd9Children(&quot;391&quot;)
#&gt; [1] &quot;3910&quot; &quot;3911&quot; &quot;3912&quot; &quot;3918&quot; &quot;3919&quot;
# mid-level code
icd9Children(&quot;0032&quot;)
#&gt; [1] &quot;00320&quot; &quot;00321&quot; &quot;00322&quot; &quot;00323&quot; &quot;00324&quot; &quot;00329&quot;
# leaf node has no children
icd9Children(&quot;00321&quot;)
#&gt; [1] &quot;00321&quot;
</code></pre>

<p>By adding <code>onlyReal = TRUE</code>, all syntactically valid ICD-9 codes are returned, even if not defined by CMS as diagnoses. This is relevant because of minor coding errors, or coding in a different year to the master list. A planned feature is to allow testing of an ICD-9 code against the valid codes for the year it was entered, but at present only the 2014 master list is used. This means that some older valid codes may no longer be on the list. However, there have been very few changes to ICD-9-CM in the last five years with ICD-10-CM in the wings.</p>

<pre><code class="r"># first ten possible ICD-9 child codes from 391
icd9Children(&quot;391&quot;, onlyReal = FALSE)[1:10]
#&gt;  [1] &quot;391&quot;   &quot;3910&quot;  &quot;39100&quot; &quot;39101&quot; &quot;39102&quot; &quot;39103&quot; &quot;39104&quot; &quot;39105&quot;
#&gt;  [9] &quot;39106&quot; &quot;39107&quot;
</code></pre>

<h2>Decoding ICD-9 codes to descriptions</h2>

<p>There are various ways of extracting the description of the condition described by an ICD-9 code. the icd9Explain group of functions return a data frame with a column for the ICD-9 code, a column for the full length Diagnosis, and a column for the short Description.</p>

<pre><code class="r">icd9Explain(&quot;1.0&quot;) # &#39;decimal&#39; format code inferred
#&gt; [1] &quot;Cholera due to vibrio cholerae&quot;
icd9Explain(&quot;0019&quot;) # &#39;short&#39; format code inferred
#&gt; [1] &quot;Cholera, unspecified&quot;
</code></pre>

<pre><code class="r"># we can be explicit about short vs decimal
icd9Explain(&quot;434.00&quot;, isShort = FALSE) 
#&gt; [1] &quot;Cerebral thrombosis without mention of cerebral infarction&quot;
icd9Explain(c(&quot;43410&quot;,&quot;43491&quot;), isShort = TRUE)
#&gt; [1] &quot;Cerebral embolism without mention of cerebral infarction&quot;       
#&gt; [2] &quot;Cerebral artery occlusion, unspecified with cerebral infarction&quot;
#explain top level code with children
&quot;391&quot; %&gt;% icd9Explain # single three-digit code
#&gt; [1] &quot;Rheumatic fever with heart involvement&quot;
&quot;391&quot; %&gt;% icd9Children # let&#39;s see the child codes
#&gt; [1] &quot;3910&quot; &quot;3911&quot; &quot;3912&quot; &quot;3918&quot; &quot;3919&quot;
&quot;391&quot; %&gt;% icd9Children %&gt;% icd9Explain # children condensed to parent code
#&gt; [1] &quot;Rheumatic fever with heart involvement&quot;
&quot;391&quot; %&gt;% icd9Children %&gt;% icd9Explain(doCondense = FALSE) # prevent condense
#&gt; [1] &quot;Acute rheumatic pericarditis&quot;              
#&gt; [2] &quot;Acute rheumatic endocarditis&quot;              
#&gt; [3] &quot;Acute rheumatic myocarditis&quot;               
#&gt; [4] &quot;Other acute rheumatic heart disease&quot;       
#&gt; [5] &quot;Acute rheumatic heart disease, unspecified&quot;
</code></pre>

<p>Arbitrary named list(s) of codes:</p>

<pre><code class="r">icd9Explain(list(somecodes = c(&quot;001&quot;, &quot;391.0&quot;), 
                 morecodes = c(&quot;001.1&quot;, &quot;001.9&quot;)))
#&gt; $somecodes
#&gt; [1] &quot;Cholera&quot;                      &quot;Acute rheumatic pericarditis&quot;
#&gt; 
#&gt; $morecodes
#&gt; [1] &quot;Cholera due to vibrio cholerae el tor&quot;
#&gt; [2] &quot;Cholera, unspecified&quot;
</code></pre>

<p><code>001</code> (Cholera) isn&#39;t itself a diagnostic code, i.e. leaf node in the hierarchy, but <code>390</code> (Rheumatic fever without heart involvement) is. Both are explained correctly:</p>

<pre><code class="r">icd9Explain(list(cholera = &quot;001&quot;, rheumatic_heart = &quot;390&quot;))
#&gt; $cholera
#&gt; [1] &quot;Cholera&quot;
#&gt; 
#&gt; $rheumatic_heart
#&gt; [1] &quot;Rheumatic fever without mention of heart involvement&quot;
</code></pre>

<p>Now try to explain on a non-existent (but &#39;valid&#39;) ICD-9 code:</p>

<pre><code class="r">s &lt;- icd9ExplainDecimal(&quot;001.5&quot;) # gives warning
</code></pre>

<p>As we have just seen, <em>icd9Explain</em> can convert lists of ICD-9 codes to a human-readable format. Let&#39;s apply the <code>icd9Explain</code> to a list of comorbidity ICD-9 codes in one of the commonly-used mappings. This makes comprehending a complicated list much easier. Taking the list for dementia:</p>

<pre><code class="r">length(quanDeyoComorbid[[&quot;Dementia&quot;]]) # 133 possible ICD-9 codes
#&gt; [1] 133
# icd9Explain summarizes these to just two groups:
quanDeyoComorbid[[&quot;Dementia&quot;]] %&gt;% icd9Explain(warn = FALSE)
#&gt; [1] &quot;Dementias&quot;                    &quot;Senile degeneration of brain&quot;
# contrast with:
quanDeyoComorbid[[&quot;Dementia&quot;]] %&gt;% icd9Explain(doCondense = FALSE, warn = FALSE)
#&gt;  [1] &quot;Dementias&quot;                                                                 
#&gt;  [2] &quot;Senile dementia, uncomplicated&quot;                                            
#&gt;  [3] &quot;Presenile dementia, uncomplicated&quot;                                         
#&gt;  [4] &quot;Presenile dementia with delirium&quot;                                          
#&gt;  [5] &quot;Presenile dementia with delusional features&quot;                               
#&gt;  [6] &quot;Presenile dementia with depressive features&quot;                               
#&gt;  [7] &quot;Senile dementia with delusional features&quot;                                  
#&gt;  [8] &quot;Senile dementia with depressive features&quot;                                  
#&gt;  [9] &quot;Senile dementia with delirium&quot;                                             
#&gt; [10] &quot;Vascular dementia, uncomplicated&quot;                                          
#&gt; [11] &quot;Vascular dementia, with delirium&quot;                                          
#&gt; [12] &quot;Vascular dementia, with delusions&quot;                                         
#&gt; [13] &quot;Vascular dementia, with depressed mood&quot;                                    
#&gt; [14] &quot;Other specified senile psychotic conditions&quot;                               
#&gt; [15] &quot;Unspecified senile psychotic condition&quot;                                    
#&gt; [16] &quot;Dementia in conditions classified elsewhere without behavioral disturbance&quot;
#&gt; [17] &quot;Dementia in conditions classified elsewhere with behavioral disturbance&quot;   
#&gt; [18] &quot;Senile degeneration of brain&quot;
</code></pre>

<p>Use a range with more than two hundred ICD-9 codes (most of them not real):</p>

<pre><code class="r">length(&quot;390&quot; %i9da% &quot;392.1&quot;)
#&gt; [1] 244
&quot;390&quot; %i9da% &quot;392.1&quot; %&gt;% icd9Explain(warn = FALSE)
#&gt; [1] &quot;Rheumatic fever without mention of heart involvement&quot;
#&gt; [2] &quot;Rheumatic fever with heart involvement&quot;              
#&gt; [3] &quot;Rheumatic chorea&quot;                                    
#&gt; [4] &quot;Rheumatic chorea with heart involvement&quot;
</code></pre>

<p>The warnings here are irrelevant because we know that %i9da% produces codes which do not correspond to diagnoses. However, in other usage, the user would typically expect the ICD-9 codes he or she is using to be diagnostic, hence the default to warn.</p>

<h2>Filtering by Present-on-Arrival</h2>

<p>This flag is recorded with each ICD-9 code, indicating whether that diagnosis was present on admission. With some caution, codes flagged specifically not <em>POA</em> can be treated as new diseases during an admission.</p>

<p>Present-on-arrival (POA) is typically a factor, or vector of values such as &ldquo;Y&rdquo;, &ldquo;N&rdquo;, &ldquo;X&rdquo;, &ldquo;E&rdquo;, or NA. Intermediate codes, such as &ldquo;exempt&rdquo;, &ldquo;unknown&rdquo; and NA mean that &ldquo;yes&rdquo; is not the same as &ldquo;not no.&rdquo; This requires four functions to cover the possibilities stored in icd9PoaChoices:</p>

<pre><code>#&gt; [1] &quot;yes&quot;    &quot;no&quot;     &quot;notYes&quot; &quot;notNo&quot;
</code></pre>

<p>Filter for present-on-arrival being &ldquo;Y&rdquo;</p>

<pre><code class="r">patientData %&gt;% icd9FilterPoaYes
#&gt;   visitId  icd9
#&gt; 1    1000 40201
#&gt; 4    1000 25001
#&gt; 6    1001  4011
</code></pre>

<p>Show that <em>yes</em> is not equal to <em>not no</em> (e.g. due to NA in <code>poa</code> field)</p>

<pre><code class="r">patientData %&gt;% icd9FilterPoaNotNo
#&gt;   visitId  icd9
#&gt; 1    1000 40201
#&gt; 2    1000  2258
#&gt; 4    1000 25001
#&gt; 5    1001 34400
#&gt; 6    1001  4011
#&gt; 7    1002  4011
</code></pre>

<h2>Comorbidities</h2>

<p>The comorbidities from different sources are provided as lists. At present only the most recent mapping of ICD-9 codes to comorbidities is provided. See these <a href="https://github.com/jackwasey/icd9/issues/6">github</a> <a href="https://github.com/jackwasey/icd9/issues/7">issues</a>.</p>

<p>This package contains ICD-9-CM to co-morbidity mappings from several sources, based on either the Charlson or Elixhauser lists of co-morbidities. Updated versions of these lists from <a href="http://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp">AHRQ</a> and <a href="http://www.ncbi.nlm.nih.gov/pubmed/16224307">Quan et al</a> are included, along with the original Elixhauser mapping . Since some data is provided in SAS source code format, this package has internalfunctions to parse this SAS source code and generate R data structures. This processing is limited to what is needed for this purpose, although may be generalizable and useful in other contexts. Other lists are transcribed directly from the published articles, but interpretation of SAS code used for the original publications is prefererable.</p>

<h3>AHRQ comorbidity classification</h3>

<p>The AHRQ keeps an updated version of the Elixhauser classification of ICD-9-CM codes into comorbidities, useful for research. They provide the data in the form of SAS code.</p>

<pre><code class="r">#ahrqComorbid &lt;- icd9:::parseAhrqSas() # user doesn&#39;t need to do this
names(ahrqComorbid)
#&gt;  [1] &quot;CHF&quot;          &quot;Valvular&quot;     &quot;PHTN&quot;         &quot;PVD&quot;         
#&gt;  [5] &quot;HTN&quot;          &quot;HTNcx&quot;        &quot;Paralysis&quot;    &quot;NeuroOther&quot;  
#&gt;  [9] &quot;Pulmonary&quot;    &quot;DM&quot;           &quot;DMcx&quot;         &quot;Hypothyroid&quot; 
#&gt; [13] &quot;Renal&quot;        &quot;Liver&quot;        &quot;PUD&quot;          &quot;HIV&quot;         
#&gt; [17] &quot;Lymphoma&quot;     &quot;Mets&quot;         &quot;Tumor&quot;        &quot;Rheumatic&quot;   
#&gt; [21] &quot;Coagulopathy&quot; &quot;Obesity&quot;      &quot;WeightLoss&quot;   &quot;FluidsLytes&quot; 
#&gt; [25] &quot;BloodLoss&quot;    &quot;Anemia&quot;       &quot;Alcohol&quot;      &quot;Drugs&quot;       
#&gt; [29] &quot;Psychoses&quot;    &quot;Depression&quot;
</code></pre>

<h3>Elixhauser co-morbidities</h3>

<p>Elixhauser originally devleoped this set of co-morbidities to predict long term mortality based on hospital ICD-9-CM coding records. The AHRQ comorbidities are an updated version of this, however the original Elixhauser have been used in many publications. The ICD-9-CM codes have changed slightly over the years.</p>

<pre><code class="r">names(elixComorbid)
#&gt;  [1] &quot;CHF&quot;          &quot;Arrhythmia&quot;   &quot;Valvular&quot;     &quot;PHTN&quot;        
#&gt;  [5] &quot;PVD&quot;          &quot;HTN&quot;          &quot;HTNcx&quot;        &quot;Paralysis&quot;   
#&gt;  [9] &quot;NeuroOther&quot;   &quot;Pulmonary&quot;    &quot;DM&quot;           &quot;DMcx&quot;        
#&gt; [13] &quot;Hypothyroid&quot;  &quot;Renal&quot;        &quot;Liver&quot;        &quot;PUD&quot;         
#&gt; [17] &quot;HIV&quot;          &quot;Lymphoma&quot;     &quot;Mets&quot;         &quot;Tumor&quot;       
#&gt; [21] &quot;Rheumatic&quot;    &quot;Coagulopathy&quot; &quot;Obesity&quot;      &quot;WeightLoss&quot;  
#&gt; [25] &quot;FluidsLytes&quot;  &quot;BloodLoss&quot;    &quot;Anemia&quot;       &quot;Alcohol&quot;     
#&gt; [29] &quot;Drugs&quot;        &quot;Psychoses&quot;    &quot;Depression&quot;
</code></pre>

<h3>Quan</h3>

<p>Quan&#39;s paper looked at indices using both ICD-10 and ICD-9-CM. Quan generated updated ICD-9-CM codes for all 30 of Elixhauser and all 17 of Charlson/Deyo&#39;s co-morbidities. Thus there are two &#39;Quan&#39; comorbidity mappings.</p>

<pre><code class="r">names(quanDeyoComorbid)
#&gt;  [1] &quot;MI&quot;          &quot;CHF&quot;         &quot;PVD&quot;         &quot;Stroke&quot;      &quot;Dementia&quot;   
#&gt;  [6] &quot;Pulmonary&quot;   &quot;Rheumatic&quot;   &quot;PUD&quot;         &quot;LiverMild&quot;   &quot;DM&quot;         
#&gt; [11] &quot;DMcx&quot;        &quot;Paralysis&quot;   &quot;Renal&quot;       &quot;Cancer&quot;      &quot;LiverSevere&quot;
#&gt; [16] &quot;Mets&quot;        &quot;HIV&quot;
names(quanElixComorbid)
#&gt;  [1] &quot;CHF&quot;          &quot;Arrhythmia&quot;   &quot;Valvular&quot;     &quot;PHTN&quot;        
#&gt;  [5] &quot;PVD&quot;          &quot;HTN&quot;          &quot;HTNcx&quot;        &quot;Paralysis&quot;   
#&gt;  [9] &quot;NeuroOther&quot;   &quot;Pulmonary&quot;    &quot;DM&quot;           &quot;DMcx&quot;        
#&gt; [13] &quot;Hypothyroid&quot;  &quot;Renal&quot;        &quot;Liver&quot;        &quot;PUD&quot;         
#&gt; [17] &quot;HIV&quot;          &quot;Lymphoma&quot;     &quot;Mets&quot;         &quot;Tumor&quot;       
#&gt; [21] &quot;Rheumatic&quot;    &quot;Coagulopathy&quot; &quot;Obesity&quot;      &quot;WeightLoss&quot;  
#&gt; [25] &quot;FluidsLytes&quot;  &quot;BloodLoss&quot;    &quot;Anemia&quot;       &quot;Alcohol&quot;     
#&gt; [29] &quot;Drugs&quot;        &quot;Psychoses&quot;    &quot;Depression&quot;
</code></pre>

<h2>Examples</h2>

<h3>Filter patients and create comorbidities</h3>

<p>Take my patients, find the ones where there definitely or maybe was a diagnosis present on admission, then generate comorbidities based on the AHRQ mapping. N.b. <code>NotNo</code> is not the same as <code>Yes</code> because of some exempt, unclassifiable conditions, or <code>NA</code> values for <code>poa</code>.</p>

<pre><code class="r">patientData %&gt;%
  icd9FilterPoaNotNo %&gt;%
  icd9ComorbidAhrq %&gt;%
  extract(1:9) # chop off at nine for clarity
#&gt;   visitId   CHF Valvular  PHTN   PVD  HTN Paralysis NeuroOther Pulmonary
#&gt; 1    1000  TRUE    FALSE FALSE FALSE TRUE     FALSE      FALSE     FALSE
#&gt; 2    1001 FALSE    FALSE FALSE FALSE TRUE      TRUE      FALSE     FALSE
#&gt; 3    1002 FALSE    FALSE FALSE FALSE TRUE     FALSE      FALSE     FALSE
</code></pre>

<h3>Compare two comorbidity defintions</h3>

<p>We will find the differences between some categories of the original Elixhauser and the updated version by Quan. Just taking the select few comorbidity groups for brevity:</p>

<pre><code class="r">difference &lt;- icd9DiffComorbid(elixComorbid, quanElixComorbid, 
                 names = c(&quot;CHF&quot;, &quot;PHTN&quot;, &quot;HTN&quot;, &quot;Valvular&quot;))
#&gt; Comorbidity CHF: 
#&gt; quanElixComorbid has 70 codes not in elixComorbid. First few are: &#39;Heart failure&#39; &#39;Mal hypert hrt dis w hf&#39; &#39;Mal hyp ht/kd I-IV w hf&#39; &#39;Mal hyp ht/kd stg V w hf&#39; &#39;Prim cardiomyopathy NEC&#39; 
#&gt; Comorbidity PHTN: 
#&gt; quanElixComorbid has 45 codes not in elixComorbid. First few are: &#39;Chronic pulmonary heart disease&#39; &#39;Acute cor pulmonale&#39; &#39;Arterioven fistu pul ves&#39; &#39;Pulmon circulat dis NEC&#39; 
#&gt; Comorbidity HTN: 
#&gt; quanElixComorbid has 89 codes not in elixComorbid. First few are: &#39;Essential hypertension&#39; &#39;Malignant hypertension&#39; 
#&gt; Comorbidity Valvular: 
#&gt; quanElixComorbid has 8 codes not in elixComorbid. First few are: &#39;Diseases of mitral valve&#39; &#39;Other diseases of endocardium&#39;
# reuslts also returned as data
str(difference)
#&gt; List of 4
#&gt;  $ CHF     :List of 3
#&gt;   ..$ both  : chr [1:117] &quot;39891&quot; &quot;40211&quot; &quot;40291&quot; &quot;40411&quot; ...
#&gt;   ..$ only.x: chr(0) 
#&gt;   ..$ only.y: chr [1:70] &quot;40201&quot; &quot;40401&quot; &quot;40403&quot; &quot;4254&quot; ...
#&gt;  $ PHTN    :List of 3
#&gt;   ..$ both  : chr [1:121] &quot;4160&quot; &quot;41600&quot; &quot;41601&quot; &quot;41602&quot; ...
#&gt;   ..$ only.x: chr(0) 
#&gt;   ..$ only.y: chr [1:45] &quot;4150&quot; &quot;41500&quot; &quot;41501&quot; &quot;41502&quot; ...
#&gt;  $ HTN     :List of 3
#&gt;   ..$ both  : chr [1:22] &quot;4011&quot; &quot;40110&quot; &quot;40111&quot; &quot;40112&quot; ...
#&gt;   ..$ only.x: chr(0) 
#&gt;   ..$ only.y: chr [1:89] &quot;401&quot; &quot;4010&quot; &quot;40100&quot; &quot;40101&quot; ...
#&gt;  $ Valvular:List of 3
#&gt;   ..$ both  : chr [1:624] &quot;09320&quot; &quot;09321&quot; &quot;09322&quot; &quot;09323&quot; ...
#&gt;   ..$ only.x: chr(0) 
#&gt;   ..$ only.y: chr [1:8] &quot;0932&quot; &quot;09325&quot; &quot;09326&quot; &quot;09327&quot; ...
</code></pre>

<p>Which pulmonary hypertension codes are only in Quan&#39;s version?</p>

<pre><code class="r">difference$PHTN$only.y %&gt;% icd9GetReal %&gt;% icd9Explain
#&gt; [1] &quot;Acute pulmonary heart disease&quot;                    
#&gt; [2] &quot;Chronic pulmonary heart disease&quot;                  
#&gt; [3] &quot;Arteriovenous fistula of pulmonary vessels&quot;       
#&gt; [4] &quot;Other specified diseases of pulmonary circulation&quot;
</code></pre>

<p>(Passing through <code>icd9GetReal</code> stops <code>icd9Explain</code> complaining that some of the input codes don&#39;t exist. This is because the comorbidity mappings have every possible numerical ICD-9 code, not just the official ones. Could also use <code>warn = FALSE</code> option in <code>icd9Explain</code>)</p>

<h3>Find cardiac-related ICD-9 codes:</h3>

<pre><code class="r">icd9Hierarchy[
  grepl(pattern = &quot;(heart)|(cardiac)&quot;,
        x = c(icd9Hierarchy$descLong, icd9Hierarchy$descShort),
        ignore.case = TRUE),
  &quot;icd9&quot;] %&gt;% unique -&gt; cardiac
</code></pre>

<p>then explain the list, just showing the first ten:</p>

<pre><code class="r">cardiac %&gt;% icd9Explain(warn = FALSE) %&gt;% head(10)
#&gt;  [1] &quot;Rheumatic fever without mention of heart involvement&quot; 
#&gt;  [2] &quot;Chagas&#39; disease with heart involvement&quot;               
#&gt;  [3] &quot;Other gonococcal heart disease&quot;                       
#&gt;  [4] &quot;Malignant neoplasm of heart&quot;                          
#&gt;  [5] &quot;Benign neoplasm of heart&quot;                             
#&gt;  [6] &quot;Other acute rheumatic heart disease&quot;                  
#&gt;  [7] &quot;Acute rheumatic heart disease, unspecified&quot;           
#&gt;  [8] &quot;Rheumatic chorea with heart involvement&quot;              
#&gt;  [9] &quot;Rheumatic chorea without mention of heart involvement&quot;
#&gt; [10] &quot;Rheumatic heart disease, unspecified&quot;
</code></pre>

<h3>Find comorbidities for a large number of patients.</h3>

<p>I understand that comorbiditity assignment using SAS is a lengthy business. Let&#39;s generate 100,000 patients with a random selection of comorbidities:</p>

<pre><code class="r"># codes selected from AHRQ mapping
many_patients &lt;- icd9:::randomPatients(100000) 

system.time(
  icd9ComorbidAhrq(many_patients)
  )[[&quot;elapsed&quot;]] # 2.5 seconds on my machine
#&gt; [1] 0.722
</code></pre>

<h3>Arbitrary ICD-9 mapping</h3>

<p>The user can provide any ICD-9 mapping they wish. Submissions of other peer-reviewed published mappings could be included in this package, if their license permits. Create an issue in <a href="https://github.com/jackwasey/icd9/issues">github</a> or email me at <a href="mailto:jack@jackwasey.com">jack@jackwasey.com</a>) Included in this package is a small data set called <code>icd9Chapters</code>, which lists the ICD-9-CM (and indeed ICD-9) Chapters. These can easily be expanded out and used as a mapping, so instead of a comorbidity, we see which patients have codes in each chapter of the ICD-9 defintion.</p>

<pre><code class="r">names(icd9Chapters)[c(1:5, 14)]
#&gt; [1] &quot;Infectious And Parasitic Diseases&quot;                                    
#&gt; [2] &quot;Neoplasms&quot;                                                            
#&gt; [3] &quot;Endocrine, Nutritional And Metabolic Diseases, And Immunity Disorders&quot;
#&gt; [4] &quot;Diseases Of The Blood And Blood-Forming Organs&quot;                       
#&gt; [5] &quot;Mental Disorders&quot;                                                     
#&gt; [6] &quot;Congenital Anomalies&quot;
myMap &lt;- icd9:::icd9ChaptersToMap(icd9Chapters[c(2, 5, 14)])
icd9Comorbid(patientData, myMap) # no +ve 
#&gt;   visitId Neoplasms Mental Disorders Congenital Anomalies
#&gt; 1    1000      TRUE            FALSE                FALSE
#&gt; 2    1001     FALSE            FALSE                FALSE
#&gt; 3    1002     FALSE            FALSE                FALSE
</code></pre>

<h3>Reduce comorbidity mapping from possible values to defined diagnostic codes.</h3>

<p>Suppose we want to exact match only real ICD-9 codes when looking up comorbdities for some patients. E.g. if the coder accidentally omited a trailing zero, e.g. code <code>003.20</code> (<em>Localized salmonella infection, unspecified</em>) might have been written as <code>003.2</code> which has a heading (<em>Localized salmonella infections</em>) but is not itself billable. Use of ICD-9 codes for comorbidities generally assumes the codes are either right or wrong. How do we match only real codes, for a strict interpretation of comorbidities? It&#39;s one line or R code:</p>

<pre><code class="r">ahrqStrict &lt;- lapply(ahrqComorbid, icd9GetReal)
str(ahrqComorbid[1:5]) # first five of the original:
#&gt; List of 5
#&gt;  $ CHF     : chr [1:120] &quot;39891&quot; &quot;40201&quot; &quot;40211&quot; &quot;40291&quot; ...
#&gt;  $ Valvular: chr [1:624] &quot;09320&quot; &quot;09321&quot; &quot;09322&quot; &quot;09323&quot; ...
#&gt;  $ PHTN    : chr [1:130] &quot;41511&quot; &quot;41512&quot; &quot;41513&quot; &quot;41514&quot; ...
#&gt;  $ PVD     : chr [1:585] &quot;4400&quot; &quot;44000&quot; &quot;44001&quot; &quot;44002&quot; ...
#&gt;  $ HTN     : chr [1:27] &quot;4011&quot; &quot;40110&quot; &quot;40111&quot; &quot;40112&quot; ...
str(ahrqStrict[1:5]) # and first five of the result:
#&gt; List of 5
#&gt;  $ CHF     : chr [1:25] &quot;39891&quot; &quot;40201&quot; &quot;40211&quot; &quot;40291&quot; ...
#&gt;  $ Valvular: chr [1:38] &quot;09320&quot; &quot;09321&quot; &quot;09322&quot; &quot;09323&quot; ...
#&gt;  $ PHTN    : chr [1:10] &quot;41511&quot; &quot;41512&quot; &quot;41513&quot; &quot;41519&quot; ...
#&gt;  $ PVD     : chr [1:53] &quot;4400&quot; &quot;4401&quot; &quot;44020&quot; &quot;44021&quot; ...
#&gt;  $ HTN     : chr [1:7] &quot;4011&quot; &quot;4019&quot; &quot;64200&quot; &quot;64201&quot; ...
</code></pre>

<p>Note the much smaller numbers of codes in each group, now we have discarded all the ones which are not defined as diagnoses.</p>

<h2>Conclusion</h2>

<p>This package allows fluid, fast and accurate manipulation of ICD-9 codes, especially when combined with <a href="http://cran.r-project.org/web/packages/magrittr/index.html">magrittr</a>. Suggestions, contributions and comments are welcome via <a href="https://github.com/jackwasey/icd9/issues">github</a>.</p>

</body>

</html>
